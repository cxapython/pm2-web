<div class="theme-toggle" onclick="toggleTheme()">
	<i class="icon-sun theme-icon-light"></i>
	<i class="icon-moon theme-icon-dark"></i>
	<span class="theme-label-light">深色模式</span>
	<span class="theme-label-dark">浅色模式</span>
</div>
<h1>PM2 进程监控</h1>
<ul class="nav nav-tabs" ng-controller="HostListController" ng-hide="tabs.length == 1">
	<li ng-repeat="tab in tabs" ng-class="{active: tab.selected}">
		<a ng-click="changeHost(tab.title)" data-toggle="tab">{{tab.title}}</a>
	</li>
</ul>
<section class="system" ng-controller="SystemController">
	<h2>{{hostData.system.hostname}}</h2>
	<alert ng-hide={{hostData.pm2.compatible}} class="alert-error" type="error">{{hostData.system.hostname}} 上运行的 PM2 版本与 pm2-web {{pm2WebVersion}} 不兼容，请升级 PM2 到 {{pm2VersionRequired}} 或更高版本。</alert>
	<table class="table" ng-show={{hostData.pm2.compatible}}>
		<thead>
			<tr>
				<th>进程数</th>
				<th>CPU 核心</th>
				<th>负载</th>
				<th>运行时间</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td>{{hostData.processes.length}}</td>
				<td>{{hostData.system.cpu_count}}</td>
				<td><span ng-repeat="load in hostData.system.load track by $index">{{load | decimalPlaces:2}}</span></td>
				<td>{{hostData.system.uptime | humanise}}</td>
			</tr>
		</tbody>
	</table>
	<figure id="memory" ng-show={{hostData.pm2.compatible}}>
		<figcaption>内存 (共 {{hostData.system.memory.total | memory}})</figcaption>
		<div class="memory-bar"><div class="free" style="width: {{(hostData.system.memory.free / hostData.system.memory.total) * 100}}%">{{hostData.system.memory.free | memory}} 空闲</div><div class="used" style="width: {{100 - ((hostData.system.memory.free / hostData.system.memory.total) * 100)}}%">{{hostData.system.memory.used | memory}} 已用</div></div>
	</figure>
</section>
<section class="processes" ng-controller="ProcessListController" ng-show={{hostData.pm2.compatible}}>
	<h2>进程列表</h2>
	<p class="noprocesses" ng-show="processes.length == 0">暂无运行中的进程</p>
	<article ng-repeat="process in processes">
		<ul class="information" ng-class="{'reloading': process.reloading, 'erroring': process.throwing}">
			<li class="pid">
				<h3>PID</h3>
				<p ng-click="toggleDetails(process.id)">{{process.pid}}</p>
			</li>
			<li class="script">
				<h3>名称</h3>
				<p ng-click="toggleDetails(process.id)">{{process.name}}</p>
			</li>
			<li class="restarts">
				<h3>重启</h3>
				<p ng-click="toggleDetails(process.id)">{{process.restarts}}</p>
			</li>
			<li class="uptime">
				<h3>运行时间</h3>
				<p ng-hide="process.status == 'online'" ng-click="toggleDetails(process.id)">N/A</p>
				<p ng-show="process.status == 'online'" ng-click="toggleDetails(process.id)">{{process.uptime | humanise}}</p>
			</li>
			<li class="status {{process.status}}">
				<h3>状态</h3>
				<p ng-click="toggleDetails(process.id)">
					<i title="运行中" ng-show="process.status == 'online'" class="icon-ok-circle {{process.status}}"></i>
					<i title="停止中" ng-show="process.status == 'stopping'" class="icon-ban-circle {{process.status}}"></i>
					<i title="已停止" ng-show="process.status == 'stopped'" class="icon-ban-circle {{process.status}}"></i>
					<i title="错误" ng-show="process.status == 'errored'" class="icon-exclamation-sign {{process.status}}"></i>
					<i title="启动中" ng-show="process.status == 'launching'" class="icon-repeat {{process.status}}"></i>
				</p>
			</li>
			<li class="cpu">
				<h3>CPU</h3>
				<p ng-click="toggleDetails(process.id)">{{process.cpu | decimalPlaces:2}}%</p>
			</li>
			<li class="memory">
				<h3>内存</h3>
				<p ng-click="toggleDetails(process.id)">{{process.memory | memory}}</p>
			</li>
			<li class="actions">
				<h3>操作</h3>
				<p ng-click="toggleDetails(process.id)">
					<a class="icon-play" title="启动进程" ng-hide="process.status == 'online'" ng-click="start(process.id, $event)"></a>
					<a class="icon-remove" title="停止进程" ng-hide="process.status != 'online'" ng-click="stop(process.id, $event)"></a>
					<a class="icon-refresh" title="重启进程" ng-hide="process.status != 'online'" ng-click="restart(process.id, $event)"></a>
					<a class="icon-repeat" title="重载进程" ng-hide="process.status != 'online'" ng-click="reload(process, $event)" ng-show="process.mode == 'cluster'"></a>
					<a class="icon-bug" title="调试进程" ng-show="debugEnabled && process.status == 'online'" ng-click="debug(process, $event)"></a>
					<a class="icon-code" title="编辑代码" ng-click="editCode(process, $event)"></a>
				</p>
			</li>
		</ul>
		<div class="details" ng-show="showDetails[process.id]">
			<h3>执行路径</h3>
			<p title="{{process.script}}" class="executable">{{process.script}}</p>
			<h3>资源使用</h3>
			<dl class="legend">
				<dt class="cpu">CPU</dt>
				<dd>CPU</dd>
				<dt class="memory">内存</dt>
				<dd>内存</dd>
			</dl>
			<figure resourceusage data="process.usage" style="display: block; width: 100%; height: 300px; margin: 10px 0 30px 0"></figure>
			<h3>实时日志</h3>
			<ul scrollglue>
				<li ng-repeat="log in process.logs" class="{{log.type}}" ng-bind-html="log.data | ansiToHtml" />
			</ul>
		</div>
	</article>
	
	<!-- 代码编辑器弹窗 -->
	<div class="code-editor-modal" ng-show="codeEditor.visible">
		<div class="code-editor-overlay" ng-click="closeCodeEditor()"></div>
		<div class="code-editor-container">
			<div class="code-editor-header">
				<div class="code-editor-title">
					<i class="icon-code"></i>
					<span ng-show="codeEditor.process">{{codeEditor.process.name}}</span>
					<span class="code-editor-filename" ng-show="codeEditor.currentFile">- {{codeEditor.currentFile}}</span>
					<span class="code-editor-modified" ng-show="codeEditor.modified">*</span>
				</div>
				<div class="code-editor-actions">
					<button class="btn btn-back" ng-click="goBackFile()" ng-show="codeEditor.fileHistory.length > 0" title="返回上一个文件">
						<i class="icon-arrow-left"></i>
					</button>
					<button class="btn btn-browse" ng-click="toggleFileBrowser()" title="浏览文件">
						<i class="icon-folder-open"></i>
					</button>
					<button class="btn btn-refresh" ng-click="refreshDependencies()" title="刷新依赖">
						<i class="icon-refresh"></i>
					</button>
					<button class="btn btn-save" ng-click="saveFile()" ng-disabled="!codeEditor.modified || codeEditor.saving" title="保存 (Ctrl+S)">
						<i class="icon-save" ng-hide="codeEditor.saving"></i>
						<i class="icon-spinner icon-spin" ng-show="codeEditor.saving"></i>
						保存
					</button>
					<button class="btn btn-save-restart" ng-click="saveAndRestart()" ng-disabled="!codeEditor.modified || codeEditor.saving" title="保存并重启进程">
						<i class="icon-bolt" ng-hide="codeEditor.saving"></i>
						<i class="icon-spinner icon-spin" ng-show="codeEditor.saving"></i>
						保存并重启
					</button>
					<button class="btn btn-close" ng-click="closeCodeEditor()" title="关闭">
						<i class="icon-remove"></i>
					</button>
				</div>
			</div>
			
			<div class="code-editor-message" ng-show="codeEditor.message" ng-class="{'success': codeEditor.messageType == 'success', 'error': codeEditor.messageType == 'error'}">
				<i class="icon-ok" ng-show="codeEditor.messageType == 'success'"></i>
				<i class="icon-warning-sign" ng-show="codeEditor.messageType == 'error'"></i>
				{{codeEditor.message}}
			</div>
			
			<div class="code-editor-body">
				<!-- 文件浏览器侧边栏 -->
				<div class="code-editor-sidebar" ng-show="codeEditor.showFileBrowser">
					<div class="sidebar-header">
						<span class="sidebar-title">文件浏览器</span>
						<button class="btn-icon" ng-click="navigateUp()" title="上级目录">
							<i class="icon-level-up"></i>
						</button>
					</div>
					<div class="sidebar-path">{{codeEditor.currentDir}}</div>
					<div class="sidebar-items">
						<div class="sidebar-item" ng-repeat="item in codeEditor.dirItems" ng-click="clickBrowserItem(item)">
							<i ng-class="item.isDirectory ? 'icon-folder-close' : getFileIcon(item.name)"></i>
							<span>{{item.name}}</span>
						</div>
					</div>
				</div>
				
				<!-- 代码编辑器主体 -->
				<div class="code-editor-main">
					<div class="code-editor-loading" ng-show="codeEditor.loading">
						<i class="icon-spinner icon-spin"></i>
						<span>正在加载...</span>
					</div>
					<div id="monaco-editor-container" ng-hide="codeEditor.loading"></div>
				</div>
				
				<!-- 依赖文件侧边栏 -->
				<div class="code-editor-dependencies" ng-show="codeEditor.dependencies.length > 0">
					<div class="dependencies-header">
						<i class="icon-link"></i>
						<span>本地依赖</span>
					</div>
					<div class="dependencies-list">
						<div class="dependency-item" ng-repeat="dep in codeEditor.dependencies" ng-click="openFile(dep.path)" title="{{dep.path}}">
							<i class="icon-file-text"></i>
							<span>{{dep.module}}</span>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</section>
